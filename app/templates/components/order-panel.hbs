<div class="layout-row layout-align-space-between-center">
  <div class="layout-row layout-align-start-center">
    <h2>
      {{#if editMode}}Bewerk details{{else}}Overzicht{{/if}} bestelling {{model.offerNumber}}
    </h2>
    {{#if editMode}}
      {{save-status-icon model=model task=save}}
    {{/if}}
  </div>
  <div>
    {{#if editMode}}
      {{#if isEnabledDelete}}
        {{#paper-button onClick=(perform remove) iconButton=true}}
          {{paper-icon "delete"}}
          {{#paper-tooltip}}Verwijderen{{/paper-tooltip}}
        {{/paper-button}}
      {{/if}}
      {{#paper-button onClick=(action "closeEdit") iconButton=true}}
        {{paper-icon "exit to app"}}
        {{#paper-tooltip}}Sluiten{{/paper-tooltip}}
      {{/paper-button}}
    {{else}}
      {{#paper-button onClick=(action "openEdit") iconButton=true disabled=isDisabledEdit}}
        {{paper-icon "edit mode"}}
        {{#paper-tooltip}}Aanpassen{{/paper-tooltip}}
      {{/paper-button}}
    {{/if}}
  </div>
</div>

{{#if hasInvoice}}
  {{warning-message message="Factuur reeds opgemaakt. Geen wijzigingen meer mogelijk."}}
{{else if model.isMasteredByAccess}}
  {{warning-message message="De bestelling is aangemaakt in Access en kan hier niet gewijzigd worden."}}
{{/if}}

{{#if remove.isRunning}}
  <div>
    {{paper-progress-linear}}
    <p>Aan het verwijderen...</p>
  </div>
{{else if rollbackTree.isRunning}}
  <div>
    {{paper-progress-linear}}
    <p>Aan het herstellen...</p>
  </div>
{{else if (and (not model.id) model.isSavivg)}}
  <div>
    {{paper-progress-linear}}
    <p>Aan het aanmaken...</p>
  </div>
{{else}}
  {{#if editMode}}
    {{order-edit-form model=model save=save}}
  {{else}}
    {{order-detail-panel model=model}}
  {{/if}}

  {{#if model.isMasteredByAccess}}
    <h2>Bestelde producten</h2>
    <p class="note-message">De bestelling is aangemaakt in Access. De inhoud kan hier niet weergegeven worden.</p>
  {{else}}
    <div class="case--order--orderlines layout-row layout-align-space-between-center">
      <h2>Bestelde producten</h2>
      <div class="layout-column layout-align-center-end">
        <div class="layout-row layout-align-start-center">
          <span class="text-fade-dark u-margin-right-small">Orderbevestiging</span>
          <div class="layout-row document-buttons">
            {{#if generateOrderDocument.isRunning}}
              {{paper-progress-circular diameter=18}}
            {{else}}
              <div {{action "downloadOrderDocument"}}>
                {{paper-icon "find in page"}}
                {{#paper-tooltip}}Orderbevestiging bekijken{{/paper-tooltip}}
              </div>
              {{#unless isDisabledEdit}}
                <div {{action (perform generateOrderDocument)}}>
                  {{paper-icon "restore page"}}
                  {{#paper-tooltip}}Orderbevestiging maken{{/paper-tooltip}}
                </div>
              {{/unless}}
            {{/if}}
          </div>
        </div>
        <div class="layout-row layout-align-start-center">
          <span class="text-fade-dark u-margin-right-small">Leveringsbon</span>
          <div class="layout-row document-buttons">
            {{#if generateDeliveryNote.isRunning}}
              {{paper-progress-circular diameter=18}}
            {{else}}
              <div {{action "downloadDeliveryNote"}}>
                {{paper-icon "find in page"}}
                {{#paper-tooltip}}Leveringsbon bekijken{{/paper-tooltip}}
              </div>
              {{#unless isDisabledEdit}}
                <div {{action (perform generateDeliveryNote)}}>
                  {{paper-icon "restore page"}}
                  {{#paper-tooltip}}Leveringsbon maken{{/paper-tooltip}}
                </div>
              {{/unless}}
            {{/if}}
          </div>
        </div>
      </div>
    </div>
    <div class="layout-row layout-xs-column layout-align-space-between">
      <div class="case--left-panel case--deposit-invoice--entry flex-100 layout-column">
        {{#detail-list-item label="Totaal" displayRow=true}}
          {{#detail-list-subitem label="Netto"}}
            {{fmt-currency totalAmount}}
          {{/detail-list-subitem}}
          {{#detail-list-subitem label=(concat (get (await model.vatRate) 'rate') "% BTW")}}
            {{fmt-currency (await totalVat)}}
          {{/detail-list-subitem}}
        {{/detail-list-item}}
      </div>
    </div>
    <div class="offer-document layout-column">
      <section>{{offerlines-detail-panel model=orderedOfferlines}}</section>
    </div>
  {{/if}}
{{/if}}

{{unsaved-changes-dialog show=showUnsavedChangesDialog onConfirm=(action "confirmCloseEdit")}}
