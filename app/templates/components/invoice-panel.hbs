<div class="layout-row layout-align-space-between-center">
  <div class="layout-row layout-align-start-center">
    <div>
      <h2>
        {{#if this.editMode}}Bewerk details{{else}}Overzicht{{/if}} factuur {{format-invoice-number this.model.number}}
      </h2>
    </div>
    {{#if this.editMode}}
      <SaveStatusIcon @model={{model}} @task={{this.save}} />
    {{/if}}
  </div>
  <div class="layout-row layout-align-start-center">
    {{#if this.editMode}}
      {{#if this.isEnabledDelete}}
        <PaperButton @onClick={{perform this.remove}} @iconButton={{true}}>
          {{paper-icon "delete"}}
          <PaperTooltip>Verwijderen</PaperTooltip>
        </PaperButton>
      {{/if}}
      <PaperButton @onClick={{action "closeEdit"}} @iconButton={{true}}>
        {{paper-icon "exit to app"}}
        <PaperTooltip>Sluiten</PaperTooltip>
      </PaperButton>
    {{else}}
      {{#if this.generateInvoiceDocument.isRunning}}
        <PaperProgressCircular @diameter={{18}} />
      {{else}}
        <PaperButton @onClick={{action "downloadInvoiceDocument"}} @iconButton={{true}}>
          {{paper-icon "find in page"}}
          <PaperTooltip>Factuur bekijken</PaperTooltip>
        </PaperButton>
        {{#unless this.isDisabledEdit}}
          <PaperButton @onClick={{perform this.generateInvoiceDocument}} @iconButton={{true}}>
            {{paper-icon "restore page"}}
            <PaperTooltip>Factuur maken</PaperTooltip>
          </PaperButton>
        {{/unless}}
      {{/if}}
      <PaperButton @onClick={{action "openEdit"}} @iconButton={{true}} @disabled={{this.isDisabledEdit}}>
        {{paper-icon "edit mode"}}
        <PaperTooltip>Aanpassen</PaperTooltip>
      </PaperButton>
    {{/if}}
  </div>
</div>

{{#if this.model.isBooked}}
  <WarningMessage @message="Factuur reeds geboekt. Geen wijzigingen meer mogelijk." />
{{/if}}


{{#if this.editMode}}
  {{#if this.remove.isRunning}}
    <div>
      <PaperProgressLinear />
      <p>Aan het verwijderen...</p>
    </div>
  {{else if this.rollbackTree.isRunning}}
    <div>
      <PaperProgressLinear />
      <p>Aan het herstellen...</p>
    </div>
  {{else if (and (not this.model.id) this.model.isSavivg)}}
    <div>
      <PaperProgressLinear />
      <p>Aan het aanmaken...</p>
    </div>
  {{else}}
    <InvoiceEditForm @model={{model}} @save={{this.save}} />
  {{/if}}
{{else}}
  <InvoiceDetailPanel @model={{model}} />
{{/if}}

{{#if this.model.isMasteredByAccess}}
  <div class="layout-row">
    <span class="flex"></span>
    <p class="note note--info">Beheerd in Access</p>
  </div>
{{/if}}

<UnsavedChangesDialog @show={{this.showUnsavedChangesDialog}} @onConfirm={{action "confirmCloseEdit"}} />
<MissingCertificateDialog @show={{this.showMissingCertificateDialog}} @model={{model}} @onClose={{perform this.generateInvoiceDocument}} />