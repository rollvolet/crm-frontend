<div class="layout-row layout-align-space-between-center">
  <div class="layout-row layout-align-start-center">
    <h2>Factuur {{format-invoice-number model.number}}</h2>
    {{#if editMode}}
      {{save-status-icon model=model task=save}}
    {{/if}}
  </div>
  <div>
    {{#if editMode}}
      {{#unless isDisabledEdit}}
        {{#paper-button onClick=(perform remove) iconButton=true}}
          {{paper-icon "delete"}}
          {{#paper-tooltip}}Verwijderen{{/paper-tooltip}}
        {{/paper-button}}
      {{/unless}}
      {{#paper-button onClick=(action "closeEdit") iconButton=true}}
        {{paper-icon "close"}}
        {{#paper-tooltip}}Sluiten{{/paper-tooltip}}
      {{/paper-button}}
    {{else}}
      {{#paper-button onClick=(action "downloadInvoiceDocument") iconButton=true}}
        {{paper-icon "find in page"}}
        {{#paper-tooltip}}Factuur bekijken{{/paper-tooltip}}
      {{/paper-button}}
      {{#unless isDisabledEdit}}
        {{#paper-button onClick=(action "openInvoiceDocumentDialog") iconButton=true}}
          {{paper-icon "restore page"}}
          {{#paper-tooltip}}Factuur maken{{/paper-tooltip}}
        {{/paper-button}}
      {{/unless}}
      {{#paper-button onClick=(action "openEdit") iconButton=true disabled=isDisabledEdit}}
        {{paper-icon "edit mode"}}
        {{#paper-tooltip}}Aanpassen{{/paper-tooltip}}
      {{/paper-button}}
    {{/if}}
  </div>
</div>

{{#if isDisabledEdit}}
  {{warning-message message="Factuur reeds geboekt. Geen wijzigingen meer mogelijk."}}
{{/if}}


{{#if editMode}}
  {{#if remove.isRunning}}
    <div>
      {{paper-progress-linear}}
      <p>Aan het verwijderen...</p>
    </div>
  {{else if rollbackTree.isRunning}}
    <div>
      {{paper-progress-linear}}
      <p>Aan het herstellen...</p>
    </div>
  {{else if (and (not model.id) model.isSavivg)}}
    <div>
      {{paper-progress-linear}}
      <p>Aan het aanmaken...</p>
    </div>
  {{else}}
    {{invoice-edit-form model=model save=save
        onContactChange=onContactChange onBuildingChange=onBuildingChange}}
  {{/if}}
{{else}}
  {{invoice-detail-panel model=model}}
{{/if}}

{{unsaved-changes-dialog show=showUnsavedChangesDialog onConfirm=(action "confirmCloseEdit")}}

{{#if showInvoiceDocumentNotFoundDialog}}
  {{#paper-dialog class="flex-50" onClose=(action "confirmAlert") clickOutsideToClose=true
       parent=".main-outlet" origin=".main-outlet"}}
    {{#paper-toolbar}}
      {{#paper-toolbar-tools}}<h2>Document niet gevonden</h2>{{/paper-toolbar-tools}}
    {{/paper-toolbar}}

    {{#paper-dialog-content}}
      <p>Er is nog geen factuur aangemaakt.</p>
    {{/paper-dialog-content}}

    {{#paper-dialog-actions class="layout-row"}}
      <span class="flex"></span>
      {{#paper-button onClick=(action "confirmAlert")}}OK{{/paper-button}}
    {{/paper-dialog-actions}}
  {{/paper-dialog}}
{{/if}}

{{invoice-document-dialog show=showInvoiceDocumentDialog model=model save=save}}