<div class="layout-row layout-align-space-between-center">
  <h2>Voorschotfacturen</h2>
  <PaperButton @primary={{true}} @fab={{true}} @raised={{true}} @mini={{true}} @onClick={{action "createNew"}} @disabled={{or this.isDisabledEdit this.selected}}>
    {{paper-icon "add"}}
    <PaperTooltip>Maak nieuwe voorschotfactuur</PaperTooltip>
  </PaperButton>
</div>

{{#liquid-if this.editMode class="data-table-selection"}}
  <div class="layout-row layout-align-space-between-center">
    <div class="layout-row layout-align-start-center">
      <h2>Factuur {{format-invoice-number this.selected.number}}</h2>
      <SaveStatusIcon @model={{selected}} @task={{this.save}} />
    </div>
    <div>
      <PaperButton @onClick={{action "closeEdit"}} @iconButton={{true}}>
        {{paper-icon "exit to app"}}
        <PaperTooltip>Sluiten</PaperTooltip>
      </PaperButton>
    </div>
  </div>
  <DepositInvoiceEditForm @model={{selected}} @save={{this.save}} />
{{else}}
  <div class="layout-row layout-xs-column layout-align-space-between">
    <div class="case--deposit-invoices--summary flex-100 layout-column">
      <DetailListItem @label="Totaal" @displayRow={{true}}>
        <DetailListSubitem @label="Netto">
          {{fmt-currency this.totalAmount}}
        </DetailListSubitem>
        <DetailListSubitem @label={{concat (get this.vatRate "rate") "% BTW"}}>
          {{fmt-currency (await this.totalVat)}}
        </DetailListSubitem>
      </DetailListItem>
    </div>
  </div>

  {{#each this.model as |invoice|}}
    <div class="case--deposit-invoices--detail-panel">
      <PaperDivider />
      <div class="layout-row layout-align-space-between-center">
        <h3>Voorschotfactuur {{format-invoice-number invoice.number}}</h3>
        <div>
          {{#if this.generateInvoiceDocument.isRunning}}
            <PaperProgressCircular @diameter={{18}} />
          {{else}}
            <PaperButton @onClick={{action "downloadInvoiceDocument" invoice}} @iconButton={{true}}>
              {{paper-icon "find in page"}}
              <PaperTooltip>Voorschotfactuur bekijken</PaperTooltip>
            </PaperButton>
            {{#unless (or this.isDisabledEdit invoice.isBooked)}}
              <PaperButton @onClick={{perform this.generateInvoiceDocument invoice}} @iconButton={{true}}>
                {{paper-icon "restore page"}}
                <PaperTooltip>Voorschotfactuur maken</PaperTooltip>
              </PaperButton>
            {{/unless}}
          {{/if}}
          {{#unless (or this.isDisabledEdit invoice.isBooked)}}
            <PaperButton @onClick={{action "openEdit" invoice}} @iconButton={{true}}>
              {{paper-icon "edit mode"}}
              <PaperTooltip>Bewerken</PaperTooltip>
            </PaperButton>
            <PaperButton @onClick={{action "remove" invoice}} @iconButton={{true}}>
              {{paper-icon "delete"}}
              <PaperTooltip>Verwijderen</PaperTooltip>
            </PaperButton>
          {{/unless}}
          {{#if invoice.isBooked}}
            {{paper-icon "lock"}}
            <PaperTooltip>Geboekt in boekhouding</PaperTooltip>
          {{/if}}
        </div>
      </div>
      <div class="layout-row layout-xs-column layout-align-space-between">
        <div class="case--left-panel case--deposit-invoice--entry flex-100 layout-column">
          <DetailListItem @label="Factuurdatum">
            {{fmt-date invoice.invoiceDate}}
          </DetailListItem>
          <DetailListItem @label="Vervaldag">
            {{fmt-date invoice.dueDate}}
          </DetailListItem>
          <DetailListItem @label="Geboekt">
            {{fmt-date invoice.bookingDate}}
          </DetailListItem>
          <DetailListItem @label="Betaald">
            {{fmt-date invoice.paymentDate}}
          </DetailListItem>
          <DetailListItem @label="Referentie">
            {{invoice.reference}}
          </DetailListItem>
          <DetailListItem @label="Opmerking">
            <span class="html-body">{{invoice.comment}}</span>
          </DetailListItem>
        </div>
        <div class="case--right-panel flex-noshrink layout-column">
          <DetailListItem @label="Nettobedrag">
            {{fmt-currency invoice.arithmeticAmount}}
          </DetailListItem>
          <DetailListItem @label="BTW">
            {{fmt-currency (await invoice.arithmeticVat)}}
          </DetailListItem>
          <DetailListItem @label="Betaalref.">
            {{format-bank-reference invoice.bankReference}}
          </DetailListItem>
          {{#if invoice.certificateRequired}}
            <DetailListItem @label="BTW-attest" @class="layout-align-start-center">
              <CertificateDocumentButtons @model={{invoice}} />
            </DetailListItem>
          {{/if}}
        </div>
      </div>
    </div>
  {{/each}}
{{/liquid-if}}

<UnsavedChangesDialog @show={{this.showUnsavedChangesDialog}} @onConfirm={{action "confirmCloseEdit"}} />
